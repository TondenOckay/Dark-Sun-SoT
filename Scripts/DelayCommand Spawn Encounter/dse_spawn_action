// ============================================================================
// DSE_SPAWN_ACTION: THE MUSCLE
// This script spawns the monsters and "brands" them with the Player's name.
// ============================================================================
#include "dse_inc"

void main() {
    // 'OBJECT_SELF' is the Player who is getting the monsters.
    object oPC = OBJECT_SELF;
    string sOwnerName = GetName(oPC);
    location lPC = GetLocation(oPC);
    object oArea = GetArea(oPC);

    // Decide how many to spawn (a random number between 1 and 4).
    int nToSpawn = d4();

    int i;
    for (i = 1; i <= nToSpawn; i++) {
        // --- START OF RANDOM LOCATION MATH ---
        // We pick a random angle (0-360) and a random distance (5-10 meters).
        float fAngle = IntToFloat(Random(360));
        float fDist  = 5.0 + IntToFloat(Random(6));

        // This creates a point in space near the player.
        vector vPos = GetPositionFromLocation(lPC);
        vPos.x += fDist * cos(fAngle);
        vPos.y += fDist * sin(fAngle);

        location lSpawn = Location(oArea, vPos, fAngle);
        // --- END OF RANDOM LOCATION MATH ---

        // Create the monster (Standard Skeleton).
        // Note: Ensure "nw_skeleton" is a valid ResRef in your palette!
        object oNewMob = CreateObject(OBJECT_TYPE_CREATURE, "nw_skeleton", lSpawn);

        // IMPORTANT: Staple the player's name to the monster!
        // This is the "Owner Brand" the Radar looks for.
        if (GetIsObjectValid(oNewMob)) {
            SetLocalString(oNewMob, "MOB_OWNER", sOwnerName);

            // A cool purple "Summon" effect so you know it worked.
            ApplyEffectAtLocation(DURATION_TYPE_INSTANT, EffectVisualEffect(VFX_FNF_SUMMON_UNDEAD), lSpawn);
        }
    }

    DSE_Debug(oPC, "SPAWNER: Created " + IntToString(nToSpawn) + " monsters for " + sOwnerName);
}
