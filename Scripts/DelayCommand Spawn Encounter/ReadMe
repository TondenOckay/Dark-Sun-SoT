Readme

DSE Engine Version 6.0: Technical Manual

Core Philosophy: The Master Controller (Area-Side)

The DSE Engine (Dynamic Spawn Engine) is designed for high-performance, low-lag encounter management in 
Neverwinter Nights: Enhanced Edition. Unlike traditional spawners that rely on creature heartbeats, this 
engine utilizes a centralized "Pulse" logic that scans, validates, and cleans the environment every 120 seconds.

1. The Architecture: "The Virtual Array"

Version 6.0 solves the "Aurora Loop Reset" bug by decoupling detection from action. 
The script operates in four distinct, non-overlapping phases.
Phase 1: The Scan (Data Collection)

The engine performs a GetFirstObjectInArea loop. It touches nothing. It simply categorizes every DSE-tagged
creature into one of two "Virtual Arrays" stored as temporary local objects on the Area:
    - Transfer List (T_T_): Creatures whose owners have died or left, but who are within 60m of a valid "Heir" (another player or VIP).
    - Kill List (T_K_): Creatures that have been outrun (>60m), have no possible heirs, or exist in an area where no players remain.

Phase 2: Mass Transfer (The Hand-off)

The engine processes the Transfer List.
    - It updates the creature's DSE_OWNER variable to the new Heir.
    - It registers the creature in one of the Heir's 6 available Encounter Slots.
    - It issues a ClearAllActions and ActionAttack to ensure the creature immediately engages the new target.

Phase 3: Mass Cleanup (The Purge)

The engine processes the Kill List.
    - It strips the Plot flag to ensure the object is destructible.
    - It clears actions to prevent "ghosting" (zombies moving while being destroyed).
    - It executes DestroyObject, effectively reclaiming server memory.

Phase 4: Flow Control (The Re-Roll)

Only after the area is clean does the engine check the players. If a player has no active encounter slots filled 
and is not in combat with "wild" hostiles, the engine rolls a d100 for a new encounter.

2. Logic Constraints & Constants
Feature	         Value	         Technical Purpose
Pulse             Rate	         120.0s	Balanced to prevent script-lag while ensuring map cleanliness.
Max Slots	        6	         Prevents "Mob Bloat" and protects server CPU.
Outrun Range	   60.0m	         Allows players to tactically retreat and "despawn" pursuit.
Spawn Stagger	   0.4s	         Staggers CreateObject calls to prevent FPS hitches on spawn.
Combat Check	   40.0m	         Prevents new spawns if a player is already fighting non-DSE mobs.

3. Variable Reference Table

These variables are used to track the "state" of the world.
    - DSE_IS_MOB (Int): Placed on all spawned creatures. Tells the engine "I am part of this system."
    - DSE_OWNER (Object): Placed on the creature. Points to the VIP it is currently hunting.
    - DSE_MOB_1 through DSE_MOB_6 (Object): Placed on the Player. Tracks which creatures are currently occupying their encounter slots.
    - DSE_VIP_X (Object): Placed on the Area. Tracks who is currently eligible for spawns (Players, Bill, Bob).

4. Best Practices for Maintenance
    - Reverting: If logic becomes unstable, revert to Version 6.0. This is the confirmed "Solid Base."
    - Monster Lists: To add monsters, edit the SpawnEncounter function. The engine will automatically handle the cleanup and transfer of any new ResRefs added there.
    - Readability: Maintain the 300+ line count. The vertical spacing is not "bloat"‚Äîit is essential for identifying where one Phase ends and the next begins during live debugging.

This manual is now the definitive guide for your Engine. Would you like me to generate a "Changelog" for your records, or should we begin drafting Version 6.1 with new creature types?



Instalation

This document serves as the "Wiring Diagram" for the Dynamic Spawn Engine (DSE). It identifies exactly where each script file connects to the Neverwinter Nights Toolset.
üìÇ DSE System: Script Placement Guide
Script Name	            Toolset Location	            Event Slot	            Description
dse_inc	                 Script Editor	           N/A (Include)	        The "Settings" file. It is not placed in a slot; other scripts "pull" settings from it.
dse_area_enter	          Area Properties              OnAreaEnter	           The "Doorman." It registers Bob and Bill and starts the Brain Loop.
dse_area_exit	          Area Properties	             OnAreaExit	           The "Checkout." It notifies the system when a player leaves the map.
dse_area_loop	           Script Editor	           N/A (Virtual)	        The "Brain." It is called by the Enter script and then runs itself on a timer.
dse_spawn_action	        Script Editor              N/A (Virtual)	        The "Muscle." It is called by the Brain to create and "Brand" monsters.

üïπÔ∏è Non-Script Setup (Required)

To ensure the scripts can "see" the players and monsters correctly, you must set these specific fields in the Toolset:

1. The Monster (Creature Blueprint)
    - Tag: Must be exactly DSE_SPAWN (or whatever you set in dse_inc).
    - ResRef: Must match the name used in the CreateObject line within dse_spawn_action (e.g., nw_skeleton).
    - Scripts: It is recommended to clear the OnDeath and OnHeartbeat slots to maximize server performance.

2. The Area (Area Properties)
    - Events Tab: Ensure dse_area_enter is selected in the OnAreaEnter dropdown.
    - Variables: No variables need to be set manually; the Brain script will create the "VIP List" automatically when Bob or Bill walks in.

üîç Installation Checklist
    [ ] dse_inc is saved and compiled.
    [ ] dse_spawn_action is saved and compiled.
    [ ] dse_area_loop is saved and compiled.
    [ ] dse_area_enter is plugged into the Area's OnAreaEnter slot.
    [ ] dse_area_exit is plugged into the Area's OnAreaExit slot.
    [ ] Creature Tag is set to DSE_SPAWN.

Testing Tip: If you have Debug Mode turned on in dse_inc, your first test should be walking into the area. If the "Wiring" is correct, you will immediately receive a yellow message in your chat log saying "BRAIN: Starting loop..."


