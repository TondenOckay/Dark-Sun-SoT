Readme

DSE Engine Version 6.0: Technical Manual

Core Philosophy: The Master Controller (Area-Side)

The DSE Engine (Dynamic Spawn Engine) is designed for high-performance, low-lag encounter management in 
Neverwinter Nights: Enhanced Edition. Unlike traditional spawners that rely on creature heartbeats, this 
engine utilizes a centralized "Pulse" logic that scans, validates, and cleans the environment every 120 seconds.

1. The Architecture: "The Virtual Array"

Version 6.0 solves the "Aurora Loop Reset" bug by decoupling detection from action. 
The script operates in four distinct, non-overlapping phases.
Phase 1: The Scan (Data Collection)

The engine performs a GetFirstObjectInArea loop. It touches nothing. It simply categorizes every DSE-tagged
creature into one of two "Virtual Arrays" stored as temporary local objects on the Area:
    - Transfer List (T_T_): Creatures whose owners have died or left, but who are within 60m of a valid "Heir" (another player or VIP).
    - Kill List (T_K_): Creatures that have been outrun (>60m), have no possible heirs, or exist in an area where no players remain.

Phase 2: Mass Transfer (The Hand-off)

The engine processes the Transfer List.
    - It updates the creature's DSE_OWNER variable to the new Heir.
    - It registers the creature in one of the Heir's 6 available Encounter Slots.
    - It issues a ClearAllActions and ActionAttack to ensure the creature immediately engages the new target.

Phase 3: Mass Cleanup (The Purge)

The engine processes the Kill List.
    - It strips the Plot flag to ensure the object is destructible.
    - It clears actions to prevent "ghosting" (zombies moving while being destroyed).
    - It executes DestroyObject, effectively reclaiming server memory.

Phase 4: Flow Control (The Re-Roll)

Only after the area is clean does the engine check the players. If a player has no active encounter slots filled 
and is not in combat with "wild" hostiles, the engine rolls a d100 for a new encounter.

2. Logic Constraints & Constants
Feature	         Value	         Technical Purpose
Pulse             Rate	         120.0s	Balanced to prevent script-lag while ensuring map cleanliness.
Max Slots	        6	         Prevents "Mob Bloat" and protects server CPU.
Outrun Range	   60.0m	         Allows players to tactically retreat and "despawn" pursuit.
Spawn Stagger	   0.4s	         Staggers CreateObject calls to prevent FPS hitches on spawn.
Combat Check	   40.0m	         Prevents new spawns if a player is already fighting non-DSE mobs.

3. Variable Reference Table

These variables are used to track the "state" of the world.
    - DSE_IS_MOB (Int): Placed on all spawned creatures. Tells the engine "I am part of this system."
    - DSE_OWNER (Object): Placed on the creature. Points to the VIP it is currently hunting.
    - DSE_MOB_1 through DSE_MOB_6 (Object): Placed on the Player. Tracks which creatures are currently occupying their encounter slots.
    - DSE_VIP_X (Object): Placed on the Area. Tracks who is currently eligible for spawns (Players, Bill, Bob).

4. Best Practices for Maintenance
    - Reverting: If logic becomes unstable, revert to Version 6.0. This is the confirmed "Solid Base."
    - Monster Lists: To add monsters, edit the SpawnEncounter function. The engine will automatically handle the cleanup and transfer of any new ResRefs added there.
    - Readability: Maintain the 300+ line count. The vertical spacing is not "bloat"â€”it is essential for identifying where one Phase ends and the next begins during live debugging.

This manual is now the definitive guide for your Engine. Would you like me to generate a "Changelog" for your records, or should we begin drafting Version 6.1 with new creature types?



Instalation

This guide focuses on the environmental setup within the NWN Toolset. Since the code is already written, the system relies on specific "Hooks" and "Tags" to function correctly.

Follow these steps to integrate the DSE Engine v6.0 into your module.

1. The Area "Brain" Setup

The engine lives inside the Area itself. You must tell the Area to start the "Pulse."

    - Open your Area properties.
    - Go to the Events tab.
    - Look for the OnEnter slot.
    - If you have an existing script there, add this line to it. If not, create a simple script containing:
    

    void main() {
        ExecuteScript("dse_engine", OBJECT_SELF);
    }


    Note: This "kicks" the engine into gear the moment the first player arrives.

2. Creating your "VIPs" (Bill & Bob)

The engine is programmed to look for specific tags to define who "owns" an encounter.

    - Create or find the NPC creatures you want to use as VIPs.
    - In the General tab of the Creature Properties, set the Tag exactly to: Bill or Bob.
    - Registration: For the engine to track them, they must be added to the Area's VIP list. You can do this by placing a script in the NPC's OnSpawn event:
    

    void main() {
        object oArea = GetArea(OBJECT_SELF);
        int nCount = GetLocalInt(oArea, "DSE_VIP_COUNT") + 1;
        SetLocalInt(oArea, "DSE_VIP_COUNT", nCount);
        SetLocalObject(oArea, "DSE_VIP_" + IntToString(nCount), OBJECT_SELF);
    }


3. Monster Blueprint Preparation

The engine spawns creatures using ResRefs. For the cleanup and transfer to work, the blueprints in your palette must be compatible.
    - Find the creatures listed in your SpawnEncounter function (e.g., nw_skeleton, nw_mummy).
    - Ensure these creatures are not marked as "Plot" or "Immortal" by default in the blueprint.
    - Important: You do not need to put any special variables on the blueprints themselves; the script injects DSE_IS_MOB and DSE_OWNER automatically at the moment of birth.

4. Setting the Boundaries (Waypoints)

While the engine calculates distance mathematically, it helps to ensure your Area is navigable.

    The 60m Rule: Ensure your Area is large enough to allow a player to actually get 60 meters away from a mob.
        - A standard NWN "Tile" is 10x10 meters.
        - To outrun a mob, a player needs to move roughly 6 full tiles away from the creature's last position.

5. Summary of System Variables

If you need to check if the system is running during a live game using "Debug Mode," these are the variables stored on the Area Object:
Variable Name	    Type	    Value
DSE_ACTIVE	        Integer	    1 (System is pulsing)
DSE_VIP_COUNT	    Integer	    Total number of Players + Bill + Bob
DSE_VIP_1	        Object	    The first tracked person (usually the first player)

6. Troubleshooting the Toolset Setup

    - Monsters aren't despawning: Check if the Area script is actually firing. If you enter the area and don't see the "--- Pulse Start ---" message, the OnEnter script is missing.
    - Bill/Bob aren't getting mobs: Ensure their Tag matches exactly (case-sensitive). If the tag is bill (lowercase), the engine won't recognize them as an "Heir."

Would you like me to create a "Debug Item" script for you? I can write a short script for a "wand" that you can use in-game to see exactly which VIPs the engine is currently tracking.
